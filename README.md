# –ó–∞–¥–∞–Ω–∏–µ

> **–ó–∞–¥–∞—á–∞ –æ—Ç –±–∏–∑–Ω–µ—Å–∞ –∑–≤—É—á–∏—Ç —Ç–∞–∫:**  
> ‚Äú–ù–∞–º –Ω—É–∂–Ω–æ –∏–º–µ—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–≥–æ–¥–µ –≤ 50 –∫—Ä—É–ø–Ω–µ–π—à–∏—Ö –≥–æ—Ä–æ–¥–∞—Ö –º–∏—Ä–∞, –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏
> —ç—Ç–∏—Ö
> –¥–∞–Ω–Ω—ã—Ö –º—ã –±—É–¥–µ–º —É–ø—Ä–∞–≤–ª—è—Ç—å –º–æ—â–Ω–æ—Å—Ç—è–º–∏ –¥–∞—Ç–∞-—Ü–µ–Ω—Ç—Ä–æ–≤ –≤ –ø–ª–∞–Ω–µ –æ—Ö–ª–∞–∂–¥–µ–Ω–∏—è –∏
> –Ω–∞–≥—Ä—É–∑–∫–∏‚Äù.

> **–£—Ç–æ—á–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –æ—Ç –ª–∏–¥–∞:**  
> ‚Äú–ù–∞–ø–∏—à–∏ –ö–æ–ª–ª–µ–∫—Ç–æ—Ä (—Å—É—â–Ω–æ—Å—Ç—å, –æ—Ç–≤–µ—á–∞—é—â—É—é –∑–∞ —Å–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏)
> –¥–ª—è https://openweathermap.org/, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω –∫–∞–∂–¥—ã–π —á–∞—Å —Å–æ–±–∏—Ä–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
> –æ
> –ø–æ–≥–æ–¥–µ –¥–ª—è 50 –∫—Ä—É–ø–Ω–µ–π—à–∏—Ö –≥–æ—Ä–æ–¥–æ–≤ –º–∏—Ä–∞, –ø–æ—Å–ª–µ —á–µ–≥–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –ë–î. –ü—Ä–∏
> —Å–±–æ—Ä–µ –æ–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –ø–æ–±–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å, –º–æ–∂–µ–º –ª–∏ –º—ã
> –∏—Ö
> –¥–ª—è —á–µ–≥–æ-—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å? –ü—Ä–∏ –Ω–∞–ø–∏—Å–∞–Ω–∏–∏ —Å–ª–µ–¥—É–µ—Ç —É—á–∏—Ç—ã–≤–∞—Ç—å, —á—Ç–æ –∫–æ–¥ –º–æ–∂–µ—Ç —á–∞—Å—Ç–æ
> –º–µ–Ω—è—Ç—å—Å—è, –ø–æ—ç—Ç–æ–º—É —Å–ª–µ–¥—É–µ—Ç –ø–æ–¥—É–º–∞—Ç—å –æ –µ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏ –∏ –¥–∞–ª—å–Ω–µ–π—à–µ–π –ø–æ–¥–¥–µ—Ä–∂–∫–µ.
> –í—ã–±–æ—Ä —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –Ω–∞ —Ç–≤–æ–µ —É—Å–º–æ—Ç—Ä–µ–Ω–∏–µ.‚Äù

# –ü—Ä–æ–µ–∫—Ç ¬´Weather Collector¬ª –¥–ª—è DataFort

## üìå –û–ø–∏—Å–∞–Ω–∏–µ

- –ü–æ–ª—É—á–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ:
    - –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 5
      –¥–Ω–µ–π [openweathermap.org/forecast5](https://openweathermap.org/forecast5)  
      –ë–î: `weather_collector`  
      –ö–æ–ª–ª–µ–∫—Ü–∏—è: `current_weather`
    - –¢–µ–∫—É—â–∞—è
      –ø–æ–≥–æ–¥–∞ [openweathermap.org/current](https://openweathermap.org/current)  
      –ë–î: `weather_collector`  
      –ö–æ–ª–ª–µ–∫—Ü–∏—è: `five_day_weather_forecast`  
      (–¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ –≤ –±—É–¥—É—â–µ–º)

–í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ –∫–∞–∫ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω –î–∞—Ç–∞-—Ü–µ–Ω—Ç—Ä –∏ —Ç–æ–≥–æ –∫–∞–∫ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç
–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è, –º–æ–∂–µ—Ç –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è –±–û–ª—å—à–∞—è —á–∞—Å—Ç—å –ø–æ–ª—É—á–∞–µ–º–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ—Ç
[openweathermap.org](https://openweathermap.org), –µ—Å–ª–∏ –Ω–µ –≤—Å—è.

–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å, —Ç–æ–ª—å–∫–æ –∫ –∫–∞–∂–¥–æ–º—É –¥–æ–∫—É–º–µ–Ω—Ç—É –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞—à
`city_id`. –ü—Ä–∏ —ç—Ç–æ–º –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º –∫–ª–∞—Å—Å–µ
–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ `handlers.WeatherHandler._data_cleaner` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ç–æ–¥ –æ—á–∏—Å—Ç–∫–∏
–¥–∞–Ω–Ω—ã—Ö, –µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è.

![diagram.png](docs/images/diagram.png)

## üìå –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

- üìÅ`data/`
    - üìÑ`cities.json` ‚Äî –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ 50 –∫—Ä—É–ø–Ω–µ–π—à–∏–º –≥–æ—Ä–æ–¥–∞–º.
- üìÅ`src/` ‚Äî –∫–æ–¥–æ–≤–∞—è –±–∞–∑–∞.
    - üìÅ`db`
        - üìÑ`cities.py` ‚Äî –º–æ–¥—É–ª—å –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤.
        - üìÑ`models.py` ‚Äî –º–æ–¥–µ–ª–∏ –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π.
        - üìÑ`mongodb.py` ‚Äî –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫ MongoDB.
    - üìÅ`tools`
        - üìÑ`requestor.py` ‚Äî –º–æ–¥—É–ª—å –¥–ª—è http –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –≥–æ—Ä–æ–¥–∞–º.
        - üìÑ`scheduler.py` ‚Äî –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á.
    - üìÅ`weather`
        - üìÑ`handlers.py` ‚Äî –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö (–æ—á–∏—Å—Ç–∫–∞, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î).
        - üìÑ`task.py` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á (–∑–∞–ø—Ä–æ—Å–æ–≤) –¥–ª—è –≥–æ—Ä–æ–¥–∞.
    - üìÑ`config.py`
    - üìÑ`main.py`

## üìå –ó–∞–ø—É—Å–∫

1. –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å `.env.template` –≤ `.env`  
   1.1 (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –í `.env` —Ñ–∞–π–ª–µ –ø—Ä–æ–ø–∏—Å–∞—Ç—å —Å–≤–æ–π API –∫–ª—é—á
   [openweathermap.org](https://openweathermap.org) –≤ `OPENWEATHERMAP_API_KEY`
2. `make up`

## üìå –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–∏—Å–∞ (.env)

```dotenv
# –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–≥–æ–¥–µ –ø–æ –≤—Å–µ–º –≥–æ—Ä–æ–¥–∞–º
# 24 ‚Äî –∫–∞–∂–¥—ã–π —á–∞—Å
REQUESTS_PER_DAY=24

# –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ (–∞–Ω—Ç–∏—Ñ–ª—É–¥)
DELAY_BETWEEN_REQUESTS=0.1

# –ü—É—Ç—å –¥–æ `cities.json` —Å –¥–∞–Ω–Ω—ã–º–∏ –≥–æ—Ä–æ–¥–æ–≤
CITY_JSON="../data/cities.json"
```

## üìå –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ 50 –≥–æ—Ä–æ–¥–æ–≤ –∏–∑ ChatGPT

```prompt
1.
–ù—É–∂–µ–Ω JSON, –≤ –∫–æ—Ç–æ—Ä–æ–º –±—É–¥–µ—Ç —Å–ø–∏—Å–æ–∫ 20 –∫—Ä—É–ø–Ω–µ–π—à–∏—Ö –≥–æ—Ä–æ–¥–æ–≤ –º–∏—Ä–∞.
–ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã 1 —ç–ª–µ–º–µ–Ω—Ç–∞ —Å–ø–∏—Å–∫–∞: {"city_id": 1, "city_name": "Moscow", "country": "Russia", "lat": 19.07, "lon": 72.87}.
–ù–æ–º–µ—Ä –≥–æ—Ä–æ–¥–∞ –≤ —Å–ø–∏—Å–∫–µ, –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞, –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã. –ù–∞–∑–≤–∞–Ω–∏—è –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ.

2.
–°–ª–µ–¥—É—é—â–∏–µ 20 –≤ —Å–ø–∏—Å–∫–µ

3.
–°–ª–µ–¥—É—é—â–∏–µ 10 –≤ —Å–ø–∏—Å–∫–µ
```

> üí¨ –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `city_id` –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ —Å–ø–∏—Å–æ–∫ —É–≤–µ–ª–∏—á–∏—Ç—Å—è –∏ –ø–æ—è–≤—è—Ç—Å—è
> –≥–æ—Ä–æ–¥–∞ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏. –¢–∞–∫ –∂–µ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –æ–±—ä–µ–º–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ `id`
> —Ç–∏–ø–∞ `int` –ø–æ–∏—Å–∫ –∑–∞–ø–∏—Å–µ–π –≤ –ë–î –º–æ–∂–µ—Ç –±—ã—Ç—å –±—ã—Å—Ç—Ä–µ–µ.

## üìå –î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ

### –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏—è —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

- MongoDB
    - –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –≤–∏–¥–µ –Ω–µ–ø–ª–æ—Å–∫–æ–≥–æ JSON
    - –ù–µ—Ç —Å–≤—è–∑–µ–π/–æ—Ç–Ω–æ—à–µ–Ω–∏–π
    - –ø—Ä–æ—Å—Ç–æ–π insert –¥–∞–Ω–Ω—ã—Ö
    - –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ –∫–æ–¥–∞ python –∏ –º–æ–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ë–î

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –ù–µ –∑–Ω–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –ø–æ –∑–∞–ø—Ä–æ—Å–∞–º. –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å—Ä–∞–∑—É –¥–µ–ª–∞–µ—Ç
  –∑–∞–ø—Ä–æ—Å –ø–æ–≥–æ–¥—ã. –í —Å–ª—É—á–∞–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–Ω–æ–≤–∞ —Å–¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å
  –ø–æ–≥–æ–¥—ã –ø–æ –≤—Å–µ–º –≥–æ—Ä–æ–¥–∞–º.

- –ü—Ä–∏ –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö `REQUESTS_PER_DAY=24` –∏ `DELAY_BETWEEN_REQUESTS=0.1`
  –∏ –¥–≤—É—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö –Ω–∞ 1 –≥–æ—Ä–æ–¥ (—Ç–µ–∫—É—â–∞—è –ø–æ–≥–æ–¥–∞ –∏ –ø—Ä–æ–≥–Ω–æ–∑), —Å–∫–æ—Ä–æ—Å—Ç—å –±—É–¥–µ—Ç 5
  –≥–æ—Ä–æ–¥–æ–≤/—Å –∏–ª–∏ 18000 –≥–æ—Ä–æ–¥–æ–≤/—á–∞—Å. –ù–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å –±–æ–ª–µ–µ 18–∫ –≥–æ—Ä–æ–¥–æ–≤ –ø—Ä–∏
  —Ç–µ–∫—É—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.
